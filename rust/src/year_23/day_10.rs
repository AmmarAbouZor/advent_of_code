use std::collections::HashSet;

use crate::utls::read_text_from_file;

#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]
struct Pos {
    row: usize,
    col: usize,
}

impl Pos {
    fn new(row: usize, col: usize) -> Self {
        Self { row, col }
    }
}

#[derive(Debug)]
struct Maze {
    cells: Vec<Vec<char>>,
    start: Pos,
}

impl From<&str> for Maze {
    fn from(input: &str) -> Self {
        let mut start = None;
        let cells = input
            .lines()
            .enumerate()
            .map(|(row, line)| {
                line.chars()
                    .enumerate()
                    .map(|(col, ch)| {
                        if start.is_none() && ch == 'S' {
                            start = Some(Pos::new(row, col));
                        }
                        ch
                    })
                    .collect()
            })
            .collect();

        Maze {
            cells,
            start: start.unwrap(),
        }
    }
}

impl Maze {
    fn calc_steps(&self) -> usize {
        let starts = vec![
            // Up
            (
                'L',
                self.start,
                Pos::new(self.start.row, self.start.col + 1),
            ),
            // Down
            (
                'F',
                self.start,
                Pos::new(self.start.row, self.start.col + 1),
            ),
            // Left
            (
                '7',
                self.start,
                Pos::new(self.start.row + 1, self.start.col),
            ),
            // Right
            (
                'F',
                self.start,
                Pos::new(self.start.row + 1, self.start.col),
            ),
        ];

        for (mut ch, mut curr, mut prev) in starts {
            let mut count = 0;
            while let Some(new_pos) = self.next_valid_pos(ch, &prev, &curr) {
                count += 1;
                if new_pos == self.start {
                    return count / 2;
                }
                ch = self.get_char(&new_pos).unwrap();
                prev = curr;
                curr = new_pos;
            }
        }

        unreachable!("Must be solved before this point");
    }

    fn next_valid_pos(&self, cur_char: char, prev_pos: &Pos, curr_pos: &Pos) -> Option<Pos> {
        match cur_char {
            '|' => {
                // going up
                if prev_pos.row > curr_pos.row {
                    let next_pos = Pos::new(curr_pos.row.wrapping_sub(1), curr_pos.col);
                    self.get_valid_up(next_pos)
                }
                // going down
                else {
                    let next_pos = Pos::new(curr_pos.row + 1, curr_pos.col);
                    self.get_valid_down(next_pos)
                }
            }
            '-' => {
                // going Left
                if prev_pos.col > curr_pos.col {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col.wrapping_sub(1));
                    self.get_valid_left(next_pos)
                }
                // going right
                else {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col + 1);
                    self.get_valid_right(next_pos)
                }
            }

            'L' => {
                // going up
                if prev_pos.row == curr_pos.row {
                    let next_pos = Pos::new(curr_pos.row.wrapping_sub(1), curr_pos.col);
                    self.get_valid_up(next_pos)
                }
                // going right
                else {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col + 1);
                    self.get_valid_right(next_pos)
                }
            }
            'J' => {
                // going up
                if prev_pos.row == curr_pos.row {
                    let next_pos = Pos::new(curr_pos.row.wrapping_sub(1), curr_pos.col);
                    self.get_valid_up(next_pos)
                }
                // going left
                else {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col.wrapping_sub(1));
                    self.get_valid_left(next_pos)
                }
            }
            '7' => {
                // going down
                if prev_pos.row == curr_pos.row {
                    let next_pos = Pos::new(curr_pos.row + 1, curr_pos.col);
                    self.get_valid_down(next_pos)
                }
                // going left
                else {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col.wrapping_sub(1));
                    self.get_valid_left(next_pos)
                }
            }
            'F' => {
                // going down
                if prev_pos.row == curr_pos.row {
                    let next_pos = Pos::new(curr_pos.row + 1, curr_pos.col);
                    self.get_valid_down(next_pos)
                }
                // going right
                else {
                    let next_pos = Pos::new(curr_pos.row, curr_pos.col + 1);
                    self.get_valid_right(next_pos)
                }
            }
            '.' => None,
            invalid => unreachable!("Invaid char: '{invalid}'"),
        }
    }

    fn get_char(&self, pos: &Pos) -> Option<char> {
        self.cells
            .get(pos.row)
            .and_then(|row| row.get(pos.col).cloned())
    }

    fn get_valid_up(&self, next_pos: Pos) -> Option<Pos> {
        match self.get_char(&next_pos) {
            Some('|' | 'F' | '7' | 'S') => Some(next_pos),
            _ => None,
        }
    }

    fn get_valid_down(&self, next_pos: Pos) -> Option<Pos> {
        match self.get_char(&next_pos) {
            Some('|' | 'L' | 'J' | 'S') => Some(next_pos),
            _ => None,
        }
    }

    fn get_valid_left(&self, next_pos: Pos) -> Option<Pos> {
        match self.get_char(&next_pos) {
            Some('-' | 'L' | 'F' | 'S') => Some(next_pos),
            _ => None,
        }
    }

    fn get_valid_right(&self, next_pos: Pos) -> Option<Pos> {
        match self.get_char(&next_pos) {
            Some('-' | 'J' | '7' | 'S') => Some(next_pos),
            _ => None,
        }
    }

    fn get_loop_poses(&self) -> HashSet<Pos> {
        let starts = vec![
            // Up
            (
                'L',
                self.start,
                Pos::new(self.start.row, self.start.col + 1),
            ),
            // Down
            (
                'F',
                self.start,
                Pos::new(self.start.row, self.start.col + 1),
            ),
            // Left
            (
                '7',
                self.start,
                Pos::new(self.start.row + 1, self.start.col),
            ),
            // Right
            (
                'F',
                self.start,
                Pos::new(self.start.row + 1, self.start.col),
            ),
        ];

        for (mut ch, mut curr, mut prev) in starts {
            let mut loop_parts = HashSet::new();
            while let Some(new_pos) = self.next_valid_pos(ch, &prev, &curr) {
                loop_parts.insert(new_pos);
                if new_pos == self.start {
                    return loop_parts;
                }
                ch = self.get_char(&new_pos).unwrap();
                prev = curr;
                curr = new_pos;
            }
        }

        unreachable!("Must be solved before this point");
    }

    fn print_loop(&self) {
        let loop_poses = self.get_loop_poses();
        let lines: Vec<String> = self
            .cells
            .iter()
            .enumerate()
            .map(|(row, line)| {
                line.iter()
                    .enumerate()
                    .map(|(col, _)| {
                        let pos = Pos::new(row, col);
                        if loop_poses.contains(&pos) {
                            self.get_char(&pos).map(Self::print_readable).unwrap()
                        } else {
                            '.'
                        }
                    })
                    .collect()
            })
            .collect();

        for (idx, line) in lines.into_iter().enumerate() {
            println!("{line} {:5}", idx);
        }
    }

    fn print_readable(ch: char) -> char {
        match ch {
            '|' => '│',
            '-' => '─',
            'F' => '╭',
            '7' => '╮',
            'J' => '╯',
            'L' => '╰',
            'S' => '┼',
            invalid => unreachable!("{invalid}"),
        }
    }
}

fn calc_steps(input: &str) -> usize {
    let maze = Maze::from(input);
    maze.calc_steps()
}

fn print_maze(input: &str) {
    let maze = Maze::from(input);
    maze.print_loop();
}

fn part_1(input: &str) {
    let answer = calc_steps(input);

    println!("Part 1 answer is {answer}");
}

fn part_2(input: &str) {
    print_maze(input);
    // After printing the maze I've checked the tiles manually and marked the wanted ones with t
    // and the others with x
    let maze = "
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx     0
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx╭─╮xxxxxxxxxxxxxxxxxxxxxxxxxxx╭╮xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx     1
.................................................╭╯╭╯....................╭╮╭╮xx╭╯╰╮......................╭╮xxxxxx╭╮xxxxxxxxxxxxxxxxxxxxxxxxx     2
.................................................╰╮╰╮╭╮╭╮................││││xx╰─╮╰╮...................╭─╯│╭╮╭─╮╭╯│xx.......................     3
................................................╭╮╰╮││││╰╮...........╭╮╭─╯╰╯│xx╭╮│╭╯...................╰─╮│││╰╮╰╯╭╯╭╮x......................     4
...............................................╭╯│╭╯╰╯╰╯╭╯...........││╰───╮╰╮╭╯╰╯│....................╭─╯│││x╰─╮│x│╰─╮.....................     5
.............................................╭─╯╭╯╰╮╭───╯...........╭╯╰╮x╭─╯╭╯╰──╮╰╮╭╮.╭╮..............╰─╮││╰╮╭╮│╰╮│╭─╯.....................     6
......................................╭╮xx╭─╮│╭╮│╭╮││╭╮.............╰─╮╰╮╰─╮│╭─╮x╰╮│││.││...........╭─╮╭─╯│╰╮│││╰╮╰╯╰─╮.....................     7
.....................................╭╯│xx│╭╯╰╯│││││╰╯│.........╭╮╭╮╭╮╰╮│x╭╯╰╯╭╯xx││││╭╯╰╮.......╭╮x╰╮│╰─╮╰─╯│││╭╯╭╮╭─╯.....................     8
............................╭╮.......╰╮╰╮╭╯╰╮x╭╯││╰╯╭─╯.........││││││╭╯╰╮│╭──╯╭╮╭╯││╰╯╭─╯......╭╯╰╮x││╭╮╰─╮╭╯│││╭╯╰╯╭╮.....................     9
............................││.......╭╯╭╯╰╮╭╯╭╯╭╯╰─╮│╭──╮.....╭╮│││││││╭╮╰╯│╭╮x│││╭╯│╭─╯x╭╮╭╮xxx╰─╮│╭╯╰╯╰╮╭╯╰─╯│││╭──╯╰─╮x╭╮................    10
.........................╭╮╭╯│.......╰╮│x╭╯╰╮╰╮╰╮╭╮│││╭─╯╭╮...│╰╯╰╯│││╰╯╰╮╭╯││╭╯╰╯╰─╯╰─╮x│╰╯│x╭╮╭╮││╰╮╭╮╭╯╰─╮╭─╯│││╭────╯╭╯│................    11
.........................│││╭╯......╭─╯╰╮╰─╮│╭╯╭╯│╰╯││╰─╮││...╰───╮││╰─╮x│╰╮││╰─╮╭╮╭╮╭─╯x╰─╮╰─╯││╰╯╰╮╰╯││╭─╮││╭╮││││╭╮x╭╮╰╮│╭╮..............    12
......................╭──╯││╰─╮╭╮.╭╮╰──╮╰──╯││╭╯x╰─╮╰╯╭╮╰╯╰─╮╭───╮││╰─╮╰╮│╭╯││x╭╯││││╰──╮╭╮╰╮╭─╯╰╮╭─╯x╭╯│╰╮╰╯││╰╯╰╯╰╯╰─╯╰─╯│││..............    13
......................╰──╮│╰╮╭╯│╰─╯│╭─╮╰──╮╭╯│╰──╮x╰╮╭╯╰────╯╰──╮╰╯╰──╯╭╯│╰─╯╰╮╰╮│╰╯╰───╯││╭╯│x╭─╯╰╮╭╮│╭╯x╰─╮╰╯╭─╮╭─╮╭─╮╭──╯│╰╮.............    14
.......................╭─╯╰─╯│x╰─╮╭╯╰╮╰───╯│╭╯╭──╯╭╮│╰─╮x╭╮x╭╮╭╮│╭──╮╭╮╰╮╰───╮│╭╯╰╮╭╮╭╮xx││╰╮╰╮╰──╮││││╰╮╭──╯╭╮╰╮││╭╯│╭╯╰╮╭─╯╭╯.............    15
.......................╰╮╭──╮╰╮╭╮││╭╮╰────╮│╰╮│╭╮x││╰─╮╰╮│╰╮││││╰╯╭─╯│╰╮│╭──╮││╰╮╭╯│╰╯╰╮╭╯│╭╯╭╯x╭─╯╰╯││╭╯╰──╮│╰─╯╰╯╰─╯╰──╯│╭─╯..............    16
........................╰╯╭╮╰╮││││╰╯│╭╮╭─╮││x│││╰╮│╰──╯╭╯│╭╯│╰╯╰╮x╰─╮╰╮╰╯╰─╮╰╯╰╮│╰╮│╭──╯╰╮│╰╮│╭╮╰───╮│││x╭╮╭╯╰─────────╮╭╮│╰───╮............    17
.......................╭─╮││╭╯││╰╯╭─╯││╰╮╰╯│╭╯╰╯╭╯╰─╮╭─╯╭╯╰╮╰╮╭─╯x╭╮╰╮│╭──╮╰──╮││╭╯│╰──╮╭╯╰─╯╰╯╰╮╭─╮│││╰╮│││╭──────────╯│││╭───╯............    18
.....................╭╮╰╮╰╯││╭╯╰─╮│╭╮││╭╯╭─╯╰──╮╰─╮╭╯╰╮x╰╮╭╯╭╯╰─╮╭╯╰╮│││╭─╯╭╮╭╯│││x│╭──╯╰─╮╭─╮╭─╯╰╮╰╯│╰╮╰╯│││x╭╮╭╮x╭╮╭╮╭╯╰╯╰───╮............    19
....................╭╯╰╮╰─╮││╰╮╭─╯│││││╰╮│x╭╮╭─╯╭─╯╰─╮╰╮╭╯╰╮│╭╮╭╯╰─╮╰╯╰╯╰──╯│╰╮││╰╮││╭╮x╭╮╰╯╭╯│╭╮x╰─╮│x│╭╮│││╭╯╰╯╰╮││││╰─╮╭────╯............    20
....................╰─╮╰──╯││╭╯╰─╮╰╯╰╯╰╮│╰╮││╰─╮╰─╮╭╮│╭╯│╭─╯││╰╯╭╮x│╭╮╭╮╭╮╭╮╰─╯│╰╮╰╯╰╯╰─╯╰╮╭╯╭╯││x╭─╯╰╮╰╯│││││╭───╯││││╭╮││╭╮xx╭──╮.........    21
....................╭─╯╭──╮│││╭╮x╰────╮││╭╯│╰╮╭╯╭─╯│╰╯╰╮││╭╮│╰╮╭╯╰╮╰╯╰╯││╰╯╰──╮│╭╯╭╮╭╮╭─╮╭╯╰╮│x│╰╮╰─╮╭╯x╭╯││╰╯╰╮╭──╯││╰╯││╰╯╰─╮╰─╮╰╮........    22
..................╭╮╰──╯╭╮││││││╭─╮╭╮╭╯╰╯╰╮│╭╯╰╮╰╮x╰─╮╭╯│││││╭╯╰─╮│╭╮╭╮││x╭──╮│╰╯╭╯╰╯│╰╮╰╯╭─╯│╭╯╭╯╭╮││╭╮╰╮│╰╮╭─╯│╭──╯│╭─╯│╭──╮╰╮╭╯╭╯........    23
.............╭╮x╭╮│╰╮╭──╯╰╯╰╯╰╯│╰╮││││╭──╮╰╯╰─╮│╭╯╭╮x│╰─╯╰╯╰╯╰╮╭╮│╰╯│││╰╯╭╯╭╮│╰╮╭╯x╭╮╰─╯╭╮╰─╮││╭╯╭╯╰╯│││╭╯│╭╯╰──╯╰──╮│╰──╯│╭╮╰─╯╰╮╰─╮.......    24
..........╭──╯│x│╰╯╭╯╰────────╮│╭╯╰╯│╰╯╭╮╰╮╭──╯│╰╮│╰╮│╭───────╯││╰╮╭╯│╰─╮╰╮││╰╮││╭╮│╰──╮││╭╮│││╰╮╰──╮││╰╯╭╯╰╮╭───╮╭─╯│╭───╯││╭╮╭─╯╭╮│.......    25
..........╰──╮╰╮╰─╮╰──╮╭╮╭╮x╭─╯│╰──╮│╭╮│╰─╯│╭╮x╰╮╰╯╭╯││╭╮╭╮╭─╮x││╭╯│╭╯╭╮│╭╯│╰╮╰╯╰╯││╭──╯││││││╰╮╰╮╭─╯│╰─╮│x╭╯╰─╮x╰╯╭╮│╰╮╭╮x│╰╯╰╯╭╮│╰╯.......    26
..........╭─╮│╭╯╭╮╰──╮╰╯╰╯╰╮╰─╮│╭╮╭╯╰╯│╰──╮││╰╮x╰─╮╰╮│╰╯│││╰╮╰╮││╰╮││╭╯╰╯╰╮│x╰─╮╭─╯││╭╮x││││││╭╯╭╯╰─╮│x╭╯╰╮╰╮╭─╯╭──╯│╰╮│││╭╯╭╮╭╮│╰╯.........    27
..........╰╮╰╯│x│╰╮╭╮╰────╮╰─╮│╰╯│╰─╮╭╯╭╮╭╯││╭╯╭──╯╭╯│╭─╯│╰╮╰╮│││╭╯││╰╮x╭╮╰╯╭╮╭╯╰╮╭╯╰╯╰╮││││││╰╮╰─╮╭╯╰─╯╭╮│╭╯╰─╮╰─╮╭╯╭╯╰╯╰╯╭╯╰╯╰╯...........    28
........╭╮x╰─╮╰╮╰╮│││x╭╮╭╮╰─╮││╭─╯╭╮││╭╯│╰╮╰╯╰╮╰──╮│╭╯│╭╮╰╮╰╮││││╰╮│╰╮╰╮││x╭╯│╰╮╭╯╰╮╭╮╭╯│││││╰╮│╭─╯╰──╮╭╯│││╭──╯╭╮││╭╯╭────╯╭╮..............    29
.......╭╯╰╮╭╮╰╮│╭╯│││╭╯╰╯│╭╮│││╰╮╭╯│││╰╮│╭╯╭──╯x╭╮│││╭╯││x│╭╯│╰╯│╭╯╰╮│╭╯││╭╯╭╯x│╰─╮││╰╯╭╯╰╯╰╯╭╯││╭╮╭╮x││x││││╭╮x││││╰╮│╭╮╭╮╭╯╰─╮............    30
.......╰─╮╰╯╰─╯│╰╮╰╯╰╯╭─╮││╰╯││╭╯╰╮╰╯│╭╯││╭╯x╭─╮│╰╯╰╯│╭╯╰╮││x╰─╮││╭╮││╰╮││╰╮╰╮╭╯╭╮││╰─╮│╭───╮│╭╯││││╰╮│╰╮╰╯│││╰─╯││╰─╯╰╯╰╯╰╯╭──╯............    31
.....╭──╮╰────╮│x╰────╯╭╯╰╯╭╮│││╭╮╰─╮│╰╮╰╯│╭╮╰╮│╰───╮│╰╮╭╯││╭─╮│╰╯│╰╯╰╮│││╭╯╭╯╰╮│╰╯│╭─╯╰╯╭╮x││╰╮││││╭╯│╭╯╭╮│╰╯╭╮╭╯╰╮╭╮╭╮╭──╮╰─╮╭╮╭╮.........    32
.....│╭╮╰─╮╭──╯│╭─╮╭─╮x╰───╯││││││╭─╯╰╮╰─╮││╰╮││╭─╮╭╯╰─╯╰╮│││╭╯╰─╮╰╮╭╮│││││╭╯╭─╯╰╮╭╯╰╮╭╮╭╯╰╮│╰╮│││││╰╮││╭╯││╭─╯╰╯╭╮││╰╯╰╯╭╮│╭─╯││││.........    33
.....╰╯│╭╮╰╯╭─╮╰╯╭╯╰╮╰─╮╭╮╭╮│││╰╯│╰─╮╭╯╭╮│││╭╯││╰╮│╰──╮╭─╯││││x╭╮│╭╯││││││││x╰─╮╭╯│╭─╯││╰╮╭╯│╭╯││││╰╮││││╭╯│╰╮x╭─╯╰╯╰────╯││╰──╯╰╯│.........    34
.......│││╭─╯x╰─╮│╭╮│╭─╯│╰╯│││╰─╮│x╭╯╰╮│╰╯│││╭╯╰╮│╰╮╭─╯│╭╮│╰╯│╭╯│││╭╯││││││╰╮╭╮│╰╮││╭╮││╭╯╰╮│╰╮││││╭╯││││╰╮│╭╯╭╯╭╮╭╮╭──╮╭╮│╰─╮╭╮╭─╯.........    35
.......╰╯╰╯╭╮╭╮╭╯╰╯╰╯╰─╮╰─╮╰╯╰──╯╰─╯╭─╯╰╮╭╯││╰╮t││t╰╯╭─╯│││t╭╯│╭╯│││t╰╯││╰╯╭╯│││╭╯│││╰╯││╭─╯╰╮││││╰╯t╰╯││╭╯│╰─╯╭╯││╰╯╭╮╰╯│╰─╮╰╯╰╯...........    36
......╭╮╭╮╭╯╰╯╰╯╭╮╭╮╭─╮╰──╯╭╮╭╮╭╮╭─╮╰─╮╭╯╰╮││╭╯╭╯╰──╮╰╮╭╯│╰╮╰╮││╭╯│╰─╮╭╯╰╮╭╯╭╯╰╯╰╮││╰─╮││╰╮╭╮│╰╯│╰──╮t╭╯││x│╭╮╭╯╭╯╰──╯╰─╮│╭╮╰──╮............    37
....╭─╯╰╯╰╯╭╮╭─╮│╰╯││x╰╮╭╮╭╯││││╰╯x╰╮╭╯╰╮t│││╰╮│╭╮╭─╯t││╭╯╭╯t││╰╯╭╯╭╮││╭─╯│╭╯t╭──╯││╭╮│││╭╯│││╭─╯╭─╮╰╮╰─╯╰─╯│╰╯x╰╮╭╮╭───╯╰╯│╭╮╭╯............    38
....╰╮╭─╮╭─╯╰╯x╰╯╭╮╰╯╭─╯│││╭╯│╰╯╭╮╭─╯╰─╮╰╮╰╯│╭╯││││╭──╯│╰╮│╭─╯╰╮╭╯╭╯╰╯│╰╮╭╯╰─╮│╭─╮│││││││╰╮││││╭╮╰╮│╭╯t╭───╮╰─╮xx╰╯│╰─────╮││││x╭─╮.........    39
.....╰╯╭╯│╭───╮╭╮││╭╮╰──╯││╰─╯╭─╯│╰──╮t╰╮╰─╮╰╯t│││││╭╮╭╯╭╯│╰╮╭╮│╰╮╰─╮t│╭╯╰╮╭╮││╰╮││││╰╯│╰╮│││││││╭╯││╭╮╰─╮x╰─╮╰╮╭╮╭╯╭─────╯╰╯│╰─╯╭╯.........    40
.....╭─╯╭╯╰──╮╰╯╰╯╰╯│╭╮╭╮╰╯╭─╮╰─╮╰───╯╭╮╰╮╭╯╭──╯│╰╯││││t╰╮│t╰╯││t│╭╮│╭╯│╭╮╰╯│││╭╯│││╰─╮│╭╯││╰╯││││t╰╯││╭╮│╭╮x╰╮╰╯│╰╮╰───╮╭╮╭╮│╭─╮╰─╮........    41
.....╰──╯╭───╯╭╮╭──╮╰╯╰╯╰╮x╰╮│╭╮╰╮╭───╯╰╮╰╯t╰──╮╰─╮╰╯││╭╮│╰╮╭─╯╰╮││╰╯╰╮╰╯│t╭╯││╰╮││╰╮╭╯││t│╰╮╭╯│││╭──╯╰╯│╰╯╰─╮╰╮╭╯╭╯╭╮╭╮╰╯│││╰╯x│╭─╯........    42
.........│╭──╮│╰╯╭╮│╭───╮╰──╯╰╯│x╰╯╭─╮╭╮╰────╮╭╯╭─╯╭╮│││╰╯╭╯╰╮╭╮││╰──╮╰╮╭╯╭╯╭╯╰╮│╰╯╭╯╰╮│╰╮│╭╯╰╮││││╭╮╭─╮╰──╮╭╯x│╰╮╰─╯╰╯│╭─╯│╰──╮╰╯..........    43
.........╰╯╭─╯│x╭╯╰╯╰╮╭─╯╭──╮╭╮╰───╯t╰╯│╭╮╭──╯╰╮╰─╮││││╰╮╭╯t╭╯│╰╯╰╮╭╮╰╮││t╰╮╰╮╭╯╰─╮╰─╮││╭╯│╰╮t╰╯╰╯╰╯╰╯t╰──╮│╰╮╭╯╭╯╭──╮x╰╯╭─╯╭─╮╰╮...........    44
..........╭╯╭╮╰╮│╭╮╭─╯╰──╯╭╮╰╯╰──╮╭───╮╰╯│╰╮t╭╮│╭╮╰╯│╰╯╭╯╰─╮╰╮╰─╮╭╯│╰─╯│╰─╮│╭╯│╭─╮╰╮╭╯│││t╰─╯╭────╮t╭╮╭───╯╰─╯╰╮╰─╯╭╮│╭──╯╭╮╰╮╰─╯...........    45
..........╰─╯╰╮│╰╯╰╯╭─────╯╰─────╯│╭──╯╭╮╰─╯╭╯╰╯│╰─╮╰╮t╰╮╭╮╰╮│╭─╯╰╮╰╮╭╮╰─╮│││t│╰╮│╭╯╰╮││╰─╮╭─╯╭╮╭╮│╭╯╰╯╭──────╮╰───╯╰╯│╭──╯╰─╯╭──╮..........    46
..............╰╯╭╮╭╮╰─╮╭─╮╭─╮╭─╮╭─╯╰╮╭╮│╰╮╭─╯╭╮╭╯t╭╯╭╯╭─╯│╰╮│╰╯╭╮t╰╮╰╯╰╮╭╯││╰╮╰╮││╰╮t╰╯│╭─╯│╭╮││││╰╯╭─╮│╭─────╯╭╮x╭╮╭─╯╰───╮╭─╯╭─╯..........    47
.............╭──╯╰╯╰╮x││x╰╯x╰╯╭╯│╭──╯│╰╯╭╯╰─╮││╰╮╭╯╭╯t│╭╮│╭╯╰──╯╰─╮╰╮╭╮││╭╯│╭╯t││╰─╯╭──╯╰─╮╰╯╰╯╰╯╰──╯╭╯│╰╮╭╮╭╮x│╰╮│╰╯╭─────╯╰─╮╰╮.╭╮........    48
.............╰─────╮╰╮╰╯╭───╮x╰─╯╰───╯╭─╯╭╮╭╯││╭╯╰╮╰─╮││││╰╮╭─╮╭──╯╭╯││││╰╮│╰─╮╰╯t╭─╯╭╮╭╮╭╯t╭╮╭╮╭────╯╭╯t╰╯╰╯╰╮│╭╯│╭─╯╭╮╭╮╭─╮╭╯╭╯╭╯╰╮.......    49
.............╭──╮╭╮╰╮╰─╮╰──╮╰─╮╭──────╯╭╮││╰╮│││t╭╯╭╮││││╰╮│╰╮│╰─╮╭╯╭╯│││╭╯│╭╮╰──╮│╭╮│││││╭╮│╰╯│╰╮╭──╮│╭──╮╭─╮╰╯╰─╯╰─╮││││╰╮││╭╯.│╭─╯.......    50
...........╭─╯╭╮╰╯╰─╯╭╮╰───╯╭╮╰╯╭╮╭────╯╰╯╰╮╰╯╰╯╭╯╭╯││││╰╮││╭╯│╭─╯│╭╯t╰╯││╭╯│╰──╮││││││││││╰╯╭╮╰╮╰╯╭╮╰╯╰─╮│╰╮╰╮╭╮╭╮╭─╯│╰╯╰╮││││╭─╯│.........    51
...........╰──╯╰─────╯╰─────╯│╭╮│││╭───────╯╭╮╭╮╰─╯t╰╯││╭╯││╰╮││╭╮││╭╮t╭╯│╰╮╰──╮││││││││││╰╮╭╯╰╮╰╮╭╯╰────╯╰─╯x│││││╰╮x│╭──╯│││╰╯╭─╯.........    52
..............╭╮╭╮╭╮╭─╮╭╮╭╮╭╮╰╯╰╯╰╯╰────╮╭╮╭╯││╰─────╮│││╭╯╰╮││╰╯││││╰╮╰╮╰╮╰╮╭─╯╰╯││││││││t││╭╮╰╮│╰──╮╭╮╭╮╭╮╭╮╰╯╰╯╰─╯╭╯╰╮╭╮│╰╯╭╮╰──╮........    53
.............╭╯╰╯╰╯│╰╮││╰╯╰╯╰──╮╭╮x╭───╮╰╯││╭╯│╭─────╯╰╯╰╯t╭╯│╰╮╭╯│╰╯╭╯t╰─╯t│╰─╮t╭╯│╰╯╰╯││╭╯││╰─╯╰───╯│╰╯╰╯╰╯╰─╮╭╮╭──╯╭╮╰╯╰╯╭─╯╰╮╭╮│........    54
.............╰────╮╰─╯│╰──╮╭╮╭╮╰╯│╭╯t╭╮╰─╮╰╯╰─╯╰────╮╭─╮╭──╯╭╯╭╯╰╮╰╮╭╯t╭────╯╭─╯t│╭╯t╭╮╭╯││╭╯╰────╮╭╮╭╯╭╮╭─────╯│││╭──╯╰╮╭──╯╭╮x╰╯╰╯........    55
.........╭╮╭─╮╭╮╭╮╰╮╭╮╰─╮x╰╯╰╯╰─╮│╰──╯╰─╮╰╮╭─╮╭╮╭───╯│╭╯╰─╮╭╯t╰╮╭╯╭╯╰╮╭╯╭╮╭─╮╰─╮t╰╯╭─╯│╰─╯╰╯╭─────╯│││╭╯╰╯x╭╮x╭╮│╰╯╰╮╭╮x╰╯╭──╯╰╮╭╮..........    56
.........││╰╮││││╰─╯│╰─╮│╭╮╭╮╭──╯╰──╮╭──╯╭╯╰╮│││╰────╯╰╮╭─╯╰──╮││t╰╮╭╯╰─╯││╭╯╭╮╰─╮t╰─╮│╭╮╭─╮╰────╮╭╯╰╯╰────╯╰╮│││╭──╯││╭──╯╭╮╭╮╰╯│..........    57
........╭╯╰─╯╰╯╰╯╭──╯╭╮│││││╰╯╭╮╭──╮│╰──╮│╭╮│╰╯╰──╮╭──╮│╰─╮╭╮╭╯││╭─╯│tttt││╰╮││╭─╯╭─╮│╰╯╰╯╭╯t╭╮╭╮╰╯╭────────╮╰╯╰╯╰─╮x│╰╯╭──╯╰╯│╭─╯..........    58
........╰────────╯x╭─╯╰╯╰╯╰╯╭╮│││╭─╯╰───╯╰╯│╰────╮│╰─╮│╰╮╭╯│╰╯t╰╯│╭╮╰─╮tt││╭╯│││╭╮╰╮│╰───╮╰╮╭╯╰╯╰─╮╰─╮╭──╮╭╮╰──╮╭──╯╭╯╭╮╰────╮││x╭─╮........    59
........╭─────────╮╰─╮╭─╮╭─╮│╰╯╰╯╰─╮t╭──╮╭╮╰─╮╭─╮││╭╮││╭╯╰╮╰──╮tt││╰╮╭╯tt╰╯╰─╯╰╯│╰─╯│╭╮╭╮╰╮│╰──╮╭╮│╭╮╰╯╭─╯││╭╮x╰╯╭╮x╰╮│╰───╮╭╯╰╯x│╭╯........    60
........╰──╮╭╮╭──╮╰──╯╰╮╰╯╭╯╰─╮╭───╯╭╯╭╮╰╯╰─╮│╰╮││╰╯╰╯╰╯tt╰╮╭╮╰─╮││t││ttttttttt╭╯╭─╮││╰╯╰╮││╭─╮╰╯│╰╯│╭─╯╭─╯╰╯│╭╮╭╯╰──╯╰╮╭╮x│╰╮╭╮╭╯╰─╮.......    61
...........╰╯╰╯x╭╯╭╮╭─╮╰─╮╰──╮│╰────╯╭╯╰─╮╭╮│╰─╯╰╯╭───╮t╭─╮││╰╮╭╯╰╯t││ttttttttt│╭╯t│╰╯╭─╮╰╯││╭╯╭╮╰─╮│╰──╯╭╮╭╮╰╯╰╯╭──╮╭╮╰╯╰╮╰─╯│╰╯╭──╯╭╮╭─╮..    62
.............╭─╮│╭╯╰╯x╰──╯╭─╮╰╯╭╮╭╮╭╮╰──╮││││╭────╯╭─╮╰╮╰╮│╰╯t┼│tttt╰╯ttttttttt╰╯╭─╯╭╮╰╮╰─╮╰╯╰╮││╭─╯╰────╯╰╯╰─╮╭╮╰╮x╰╯╰──╮╰─╮x╰─╮│╭╮x│╰╯╭╯..    63
.............╰╮╰╯│╭───────╯╭╯╭╮│││╰╯╰───╯╰╯╰╯│╭──╮╭╯t╰╮╰─╯╰╮tt││ttttttttttttttt╭─╯╭─╯╰╮│╭╮╰──╮│││╰────────╮╭─╮╰╯╰─╯╭────╮│╭─╯╭╮x│││╰╮│╭─╯...    64
..............╰╮╭╯╰───────╮│x││││╰─────────╮╭╯╰─╮╰╯╭╮╭╯╭╮╭╮│tt││ttttttttttttttt╰──╯t╭╮╰╯││╭──╯││╰─────────╯│╭╯x╭─╮╭╯╭╮╭─╯│╰──╯╰─╯╰╯╭╯││╭╮...    65
.............╭─╯│x╭───╮╭──╯╰─╯╰╯╰╮x╭────╮╭─╯╰╮╭╮╰──╯│╰─╯╰╯││tt╰╯ttttttttttttttt╭────╯│╭╮││╰╮╭╮╰╯╭─╮╭╮╭─────╯╰──╯╭╯│╭╯╰╯╭─╯╭──╮╭╮╭╮╭╯x│╰╯│...    66
.............╰──╯x╰──╮│╰╮╭─╮╭─╮╭╮╰─╯╭╮╭╮╰╯╭╮t││╰╮╭─╮╰─╮╭─╮╰╯ttttttttttttttttttt╰────╮╰╯╰╯╰╮╰╯╰╮╭╯t╰╯╰╯╭╮╭────╮╭╮╰─╯╰──╮│╭╮╰╮╭╯│╰╯│╰──╯╭╮│...    67
...............╭╮x╭──╯╰─╯╰╮╰╯x╰╯╰╮╭╮│││╰──╯╰─╯╰╮╰╯t╰──╯│╭╯ttttttttttttttttttttttt╭──╯╭───╮╰───╯│╭──╮╭─╯│╰───╮╰╯│╭╮╭╮╭╮│││╰╮│╰╮╰─╮╰────╯││...    68
...............│╰╮╰──╮╭─╮╭╯╭─╮╭─╮╰╯╰╯╰╯╭──────╮╰╮╭╮t╭╮t││╭╮ttttttttttttttttttttt╭╯╭──╯t╭─╯╭─╮╭╮│╰─╮│╰─╮╰───╮╰─╮╰╯╰╯╰╯╰╯╰╯x╰╯x╰─╮╰────╮.╰╯...    69
...............╰╮╰─╮╭╯│x╰╯x╰╮│╰╮│╭────╮╰─────╮╰╮╰╯╰─╯╰╮│╰╯╰╮tttttttttttttttttttt╰─╯╭──╮╰──╯t╰╯╰╯╭╮││╭╮╰╮╭╮x╰─╮╰╮╭╮╭─╮x╭╮╭╮╭╮╭─╮╰╮╭─╮╭╯......    70
................╰─╮╰╯╭╯╭─╮x╭╯╰╮││╰───╮╰──────╯t│╭─────╯│╭──╯ttttttttttttttttttttttt╰─╮╰────╮╭╮t╭╯╰╯╰╯╰╮╰╯╰──╮│╭╯│││╭╯╭╯││╰╯╰╯╭╯x╰╯x││.......    71
..............╭──╮╰──╯x╰╮│╭╯╭╮╰╯│╭╮╭╮╰───╮╭╮t╭╮│╰────╮t│╰╮╭╮tttttttttttttttttttttt╭╮t╰────╮╰╯╰─╯╭───╮╭╯╭╮╭──╯│╰─╯╰╯│x│╭╯╰╮╭──╯x╭──╮││.......    72
..............╰─╮╰─╮╭─╮╭╯││╭╯╰─╮╰╯╰╯╰─╮╭╮╰╯╰─╯│╰─────╯╭╯╭╯││╭╮tt╭─╮tttttttttttttt╭╯╰────╮t╰─╮╭─╮│╭──╯╰─╯╰╯╭╮x│╭╮╭─╮╰─╯╰─╮││╭╮╭╮│╭─╯│╰╮......    73
.............╭──╯╭╮│╰╮│╰╮│╰╯╭╮╭╯╭──╮╭╮╰╯╰──╮╭╮╰─╮╭─╮╭╮╰╮╰╮││││╭╮│╭╯tttttttttttttt╰─╮╭╮╭╮╰───╯╰╮╰╯│╭─╮╭╮╭──╯╰╮╰╯│╰╮│╭─╮╭─╯│╰╯╰╯╰╯╰╮╭╯╭╯......    74
.............╰───╯│╰─╯╰─╯│╭─╯╰╯╭╯╭─╯│╰────╮│││╭╮│╰╮│││t│╭╯││││││││╭╮╭╮ttttttt╭╮tttt╰╯╰╯╰─╮╭╮╭╮╰╮╭╯│t╰╯╰╯╭──╮╰─╮│╭╯│╰╮│╰──╯╭╮╭─╮╭─╯╰─╯.......    75
.............╭────╯╭╮╭╮╭╮│╰───╮│╭╯╭╮│╭────╯╰╯╰╯╰╯╭╯╰╯╰─╯╰─╯╰╯││││╰╯╰╯╰╮tttttt││t╭╮╭╮╭──╮╭╯│╰╯╰─╯╰─╯╭╮╭╮t╰─╮│╭─╯╰╯╭╯╭╯│╭─╮╭╯│╰╮│╰╮x╭╮x.......    76
.............╰─────╯╰╯╰╯│╰────╯│╰─╯╰╯╰─────╮t╭╮t╭╯╭╮╭╮╭──╮╭╮╭╯│╰╯╭─╮╭╮╰─╮╭╮t╭╯╰─╯││╰╯╭─╯╰─╯t╭──────╯│││╭╮╭╯│╰──╮x╰─╯x││x╰╯x╰─╯╰─╯╭╯╰──╮.....    77
..........╭╮..╭╮╭╮╭───╮╭╯╭╮╭──╮│╭──────╮╭──╯╭╯│╭╯╭╯╰╯╰╯╭╮╰╯╰╯t╰╮╭╯t╰╯╰──╯│╰╮╰──╮╭╯╰╮╭╯╭╮╭╮╭╮╰─╮╭╮╭─╮╰╯╰╯╰╯x╰──╮╰╮╭╮x╭╯│╭─────╮╭╮x│╭──╮╰╮....    78
.........╭╯╰╮.││││╰──╮╰╯╭╯╰╯╭╮╰╯│╭─╮╭─╮╰╯╭╮t│╭╯│╭╯t╭╮╭─╯╰─╮t╭╮t││╭╮t╭╮╭─╮│╭╯╭╮╭╯╰─╮│╰╮│╰╯│││╭╮╰╯╰╯t╰─────╮╭──╮╰╮╰╯│╭╯╭╯│╭────╯│╰╮││╭╮╰╮│....    79
.........╰─╮╰─╯│││╭╮x╰─╮│╭──╯│╭╮╰╯x╰╯╭╯╭─╯╰╮│╰─╯╰──╯╰╯╭──╮╰╮││╭╯╰╯╰─╯╰╯╭╯││╭╯│╰──╮││╭╯╰─╮│││││╭╮╭╮╭╮t╭╮╭╮╰╯╭─╯╭╯╭─╯╰─╯x││╭╮╭╮x│╭╯│╰╯╰╮╰╯....    80
...........╰╮╭╮╰╯╰╯│╭╮x╰╯╰──╮╰╯╰─────╯t│╭──╯│╭──╮╭────╯╭─╯╭╯││╰─╮╭─────╯╭╯││╭╯t╭─╯│││╭╮╭╯╰╯╰╯╰╯╰╯╰╯╰─╯││╰──╯╭╮╰─╯╭╮╭╮x╭╯╰╯╰╯╰╮││x│╭──╯╭─╮...    81
..........╭╮╰╯╰─╮╭╮╰╯│╭─────╯╭╮╭───╮╭╮╭╯│╭╮t│╰─╮│╰────╮╰─╮╰╮││╭─╯│t╭─╮╭╮╰╮╰╯╰╮╭╯╭╮││││╰╯╭────────╮╭╮╭╮╰╯╭─╮x││╭─╮││││╭╯╭╮╭╮╭╮╰╯╰─╯╰─╮╭╯╭╯...    82
..........│╰╮.╭─╯│╰─╮╰╯╭╮╭╮╭╮│╰╯x╭─╯││╰╮│││╭╯╭╮││╭─╮╭─╯╭╮╰─╯││╰─╮╰╮│╭╯│╰╮│╭──╯╰─╯││││╰──╯╭───────╯│╰╯╰──╯╭╯╭╯╰╯╭╯│││││╭╯╰╯││╰─╮╭─╮╭─╯│╭╯....    83
........╭╮╰╮╰─╯╭─╯╭─╯╭─╯││╰╯╰╯x╭╮╰──╯╰╮│││││╭╯╰╯╰╯t╰╯╭╮││t╭╮│╰╮t╰╮││╰╮╰╮│││╭╮t╭╮╭╯││╰──╮╭╯╭────╮╭─╯╭─╮╭──╯╭╯╭─╮╰─╯╰╯╰╯╰─╮x╰╯x╭╯╰╮╰╯╭─╯╰─╮╭╮.    84
......╭─╯│x╰╮╭╮│╭─╯╭╮│╭─╯│╭────╯╰─╮╭─╮╰╯││╰╯╰─╮╭──╮╭─╯╰╯│╭╯││╭╯╭╮│││╭╯╭╯╰╯╰╯│╭╯╰╯╭╯│╭╮╭╯╰─╯╭─╮╭╯│╭╮╰╮│╰───╯╭╯x│╭╮╭─╮╭╮╭╮╰───╮│╭╮╰──╯╭───╯││.    85
......╰─╮╰─╮╰╯╰╯╰──╯╰╯╰─╮││╭─────╮╰╯t│╭╮╰╯╭───╯│╭─╯╰╮╭─╮│╰╮╰╯╰─╯╰╯╰╯╰╮╰╮╭───╯╰──╮╰╮││╰╯╭╮╭─╯╭╯╰╮│││╭╯│╭╮╭──╯╭╮╰╯╰╯╭╯│││╰───╮││││╭──╮╰────╯╰╮    86
........╰─╮╰╮╭────────╮x││╰╯╭─╮╭╮╰──╮││╰─╮│t╭╮╭╯╰───╯╰╮╰╯t╰─╮╭╮╭──╮╭╮│╭╯╰─╮╭────╯╭╯│╰╮╭╯│╰─╮╰─╮╰╯││╰╮│││╰───╯╰───╮╰╮││╰───╮╰╯│││╰─╮│╭─╮╭─╮╭╯    87
....╭─────╯╭╯╰─────╮╭╮╰╮╰╯╭╮╰╮││╰───╯╰╯╭─╯╰─╯╰╯╭─────╮╰╮t╭─╮╰╯╰╯╭╮││││╰╮╭─╯╰────╮│╭╯╭╯╰╮│╭─╯╭─╯╭─╯╰─╯╰╯╰─────╮╭╮╭╯x│││╭───╯╭╮││╰╮╭╯││╭╯╰╮╰╯.    88
....╰─────╮│╭╮╭──╮x╰╯╰╮╰╮╭╯│╭╯╰╯╭╮╭──╮╭╯╭─╮╭──╮╰────╮╰╮╰─╯╭╯╭╮╭╮│╰╯│╰╯╭╯│╭╮╭╮╭──╯╰╯╭╯╭─╯│╰─╮│t╭╯╭╮╭╮╭╮╭╮╭╮x╭╮╰╯╰╯x╭╯││╰╮╭──╯│││x╰╯x╰╯╰╮╭╯...    89
....╭───╮╭╯│││╰─╮│╭──╮╰╮││╭╯╰───╯╰╯╭─╯╰─╯t│╰─╮│╭─╮╭╮╰╮╰╮╭╮│╭╯╰╯│╰─╮│╭─╯╭╯│╰╯│╰──╮╭─╯t╰─╮╰─╮│╰╮╰─╯╰╯╰╯╰╯╰╯╰─╯╰─╮x╭╮╰╮│╰─╯│╭──╯╰╯x╭────╮╰╯....    90
....╰──╮│╰╮│││╭╮││╰╮╭╯╭╯╰╯│╭──────╮╰───╮╭─╯╭─╯││t╰╯╰─╯t││╰╯╰──╮│╭─╯││╭╮╰╮│╭─╯t╭╮││╭─╮╭╮╰─╮││╭╯╭╮╭╮╭╮╭─╮╭───╮╭╮╰╮││x╰╯╭─╮│╰──╮╭╮╭╯╭───╯......    91
....╭─╮│╰─╯╰╯╰╯╰╯│╭╯╰╮╰──╮╰╯╭───╮╭╯╭─╮╭╯╰─╮╰─╮╰╯╭╮╭╮t╭╮╰╯╭╮╭╮╭╯│╰─╮│╰╯╰╮╰╯╰╮╭╮│╰╯││╭╯│╰╮╭╯╰╯╰─╯││╰╯│╰╮│╰─╮x╰╯╰╮╰╯╰─╮x│╭╯│╭──╯│││╭╯x╭╮.......    92
....╰╮╰╯╭──╮╭─╮╭╮│╰╮╭╯╭──╯╭╮│x╭─╯╰─╯t╰╯╭╮╭╯╭╮╰╮╭╯╰╯╰╮││╭─╯╰╯│╰╮│t╭╯╰╮╭╮╰╮╭─╯││╰╮╭╯│╰╮╰╮││╭─────╯│╭╮╰─╯╰╮t╰──╮x╰────╯╭╯╰─╯╰─╮x││││╭╮││....╭╮.    93
....╭╯╭─╯╭─╯╰╮│││╰─╯╰─╯╭─╮│││╭╯╭─╮╭────╯││╭╯╰─╯│╭───╯││╰───╮│╭╯╰╮╰─╮╰╯│t│╰─╮││╭╯╰╮╰╮│╭╯╰╯╰───╮╭╮╰╯╰───╮│╭──╮╰────╮╭─╯╭─╮╭──╯╭╯╰╯╰╯╰╯╰──╮.││.    94
....│╭╯..╰─╮╭╯╰╯╰╮╭╮╭╮╭╯╭╯│││╰╮│╭╯│╭────╯╰╯╭╮╭─╯│╭╮╭╮│╰╮╭──╯╰╯╭╮╰──╯╭─╯╭╯╭╮╰╯│╰─╮╰─╯││╭─╮╭───╯││t╭╮╭╮t││╰─╮│╭╮╭──╯╰╮╭╯╭╯╰───╯╭╮╭╮╭─────╯x│╰╮    95
....╰╯..╭──╯│╭─╮x╰╯│││╰╮╰╮│││x╰╯╰─╯╰─────╮╭╯│╰╮╭╯│╰╯╰╯╭╯╰──╮╭─╯╰───╮╰╮╭╯╭╯╰──╯╭╮╰──╮│╰╯t││╭╮t╭╯╰─╯╰╯│╭╯╰──╯╰╯│╰──╮╭╯╰╮╰──╮╭╮╭╯│││╰───────╯╭╯    96
........╰╮╭╮││╭╯╭╮╭╯││╭╯╭╯│╰╯╭╮╭─────────╯│╭╯╭╯│t│╭─╮╭╯╭╮╭╮││╭╮╭─╮╭╯╭╯╰╮╰──╮╭─╯│╭╮╭╯╰╮t╭╯││╰╮│╭╮╭──╮╰╯╭╮╭──╮x╰───╯│╭╮╰──╮╰╯╰╯x╰╯╰╮╭╮╭╮╭╮╭╮│.    97
........╭╯││││╰─╯╰╯╭╯│╰╮╰╮╰╮╭╯╰╯╭╮╭────╮╭─╯╰╮╰╮╰╮│╰╮││╭╯│││╰╯││╰╮│╰╮╰──╯╭──╯╰─╮││││╭╮╰╮│╭╯│╭╯││││╭─╯╭─╯╰╯╭╮╰────╮╭╯││╭─╮╰──╮╭──╮╭╯│╰╯╰╯││╰╯.    98
........╰─╯╰╯╰────╮│x╰╮│╭╯╭╯╰─╮╭╯╰╯╭───╯╰──╮╰─╯╭╯│╭╯╰╯│╭╯│╰╮╭╯│╭╯│t│╭──╮╰╮╭╮╭╮││││╰╯│╭╯│╰╮│╰╮╰╯╰╯╰──╯t╭╮╭╯╰─────╯╰╮│╰╯x╰╮╭╮╰╯╭─╯│╭╯....╰╯...    99
..........╭─────╮╭╯│╭─╯│╰─╯╭──╯│╭─╮╰──╮╭─╮t╰╮╭╮╰╮│╰╮t╭╯╰╮│╭╯╰╮│╰╮╰╮││╭╮╰╮╰╯╰╯│││││t╭╯│╭╯╭╯╰╮│╭╮╭╮t╭──╮││╰─╮╭──╮╭╮╭╯╰───╮╰╯╰─╮╰─╮╰╯╭╮........   100
..........╰╮╭╮╭╮╰╯╭╯╰╮╭╯╭─╮╰───╯╰╮╰─╮╭╯╰╮│╭╮╰╯╰╮││╭╯╭╯╭─╯│╰╮t││╭╯╭╯╰╯││t╰╮╭╮╭╯│╰╯╰─╯╭╯╰╮╰╮╭╯││││╰╮╰─╮││╰──╯│╭─╯│││╭───╮╰───╮╰╮╭╯╭─╯╰╮.......   101
...........╰╯╰╯╰╮╭╯╭╮╰╯x╰╮╰───╮x╭╯╭╮╰╯╭╮││││t╭─╯││╰╮╰╮│╭╮│╭╯╭╯╰╯╭╯╭╮t│╰──╯│╰╯t╰───╮╭╯╭─╯╭╯╰╮│││╰╮│╭╮││╰────╯╰─╮│╰╯│╭╮x╰╮╭──╯╭╯╰─╯╭─╮╰─╮.....   102
...........╭────╯╰╮│╰─╮╭╮╰─╮╭╮╰─╯╭╯╰╮╭╯╰╯││╰╮╰─╮╰╯╭╯╭╯│││││╭╯╭──╯╭╯╰╮╰─╮╭╮╰╮╭──╮╭╮│╰╮╰─╮╰╮╭╯│││╭╯╰╯│││╭╮╭──╮╭─╯╰╮╭╯│╰─╮╰╯╭╮x╰──╮╭╯.│╭─╯.....   103
...........╰───╮╭─╯╰─╮││╰──╯│╰──╮│╭─╯╰╮╭─╯│╭╯╭╮│╭─╯t╰╮│││││╰╮│t╭╮╰─╮│╭╮╰╯│╭╯╰─╮││││╭╯╭╮│╭╯│╭╯││╰──╮│││││╰─╮││╭╮x│╰─╯╭╮╰──╯╰───╮│╰─╮│╰╮......   104
..........╭────╯│╭───╯│╰────╯╭╮╭╯│╰─╮╭╯│╭╮││╭╯│││╭─╮╭╯╰╯││╰╮││╭╯╰╮╭╯│││╭╮│╰─╮╭╯││││╰╮│╰╯╰╮│╰─╯╰╮╭╮│││╰╯│╭╮││╰╯╰─╯╭╮╭╯╰─╮╭─╮╭╮╭╯│╭─╯│╭╯......   105
..........│╭╮╭─╮│╰╮╭─╮│x╭╮x╭─╯╰╯╭╯╭╮│╰╮││╰╯││x││││x╰╯╭╮╭╯│╭╯││╰─╮││x╰╯││╰╯╭─╯│x│││╰╮│╰╮x╭╯╰─╮╭─╯│╰╯││╭─╯│╰╯│╭╮╭╮╭╯╰╯╭╮x╰╯x│││╰╮│╰─╮╰╯.......   106
.........╭╯│╰╯x╰╯x╰╯╭╯╰─╯╰╮╰─╮╭╮│╭╯╰╯╭╯│╰─╮││╭╯││╰──╮││╰╮││╭╯│╭─╯││╭──╯╰╮x│╭╮╰╮╰╯╰╮│╰╮│╭╯╭╮╭╯╰╮╭╯x╭╯│╰─╮╰─╮││╰╯╰╯╭──╯╰───╮╰╯│╭╯│╭─╯.........   107
.........╰─╯x╭──────╯╭───╮│╭╮││╰╯│╭╮╭╯╭╯╭╮│││╰╮││╭─╮││╰─╯││╰╮│╰─╮││╰╮╭─╮╰╮││╰╮╰──╮││x│││╭╯││╭─╯╰╮╭╯╭╯╭╮│╭╮│││╭╮╭─╯╭─╮╭──╮╰─╮│╰╮│╰╮..........   108
.............╰──╮╭╮╭╮│╭──╯╰╯│╰╯╭─╯││╰╮╰─╯╰╯│╰╮╰╯││x││╰╮╭╮│╰─╯│╭╮│││x││x│╭╯││x│╭──╯│╰╮│││╰╮╰╯╰─╮╭╯│╭╯x│╰╯││││╰╯╰╯╭─╯x╰╯╭╮╰──╯│╭╯╰─╯..........   109
..............╭─╯│││││╰──╮╭╮╰─╮╰╮╭╯│╭╯x╭╮x╭╯╭╯╭─╯╰╮│╰╮╰╯│╰──╮╰╯││││╭╯│╭╯│╭╯│╭╯╰─╮╭╯╭╯││╰╮│╭───╯│╭╯╰╮╭╯╭╮│││╰─╮╭╮╰─────╯╰───╮│╰╮x╭╮..........   110
..............╰╮╭╯││╰╯x╭─╯││╭╮╰─╯╰╮││x╭╯╰─╯╭╯x╰─╮╭╯╰─╯╭╮│╭──╯╭╮╰╯││╰╮│╰╮│╰─╯│╭╮╭╯╰╮╰╮╰╯x││╰╮╭╮╭╯╰╮╭╯│╭╯╰╯│╰╮╭╯│╰╮╭───╮╭╮╭╮╭╯╰─╯x│╰╮.........   111
...............││╭╯╰╮x╭╯╭╮││││╭╮╭╮││╰╮╰──╮╭╯╭╮╭╮│╰──╮╭╯╰╯╰─╮╭╯╰╮x││x│╰╮╰╯x╭╮││╰╯╭╮╰╮╰──╮│╰╮││││╭─╯│╭╯╰╮╭─╯╭╯╰╮│╭╯╰──╮╰╯╰╯╰╯╭╮╭╮x│╭╯.........   112
...............╰╯│╭─╯╭╯╭╯││╰╯││││╰╯│╭╯╭╮x│╰╮│╰╯╰╯╭╮╭╯│╭╮╭─╮╰╯╭╮╰╮╰╯╭╯╭╯x╭─╯╰╯╰──╯│╭╯╭╮╭╯│╭╯│││││╭╮││╭╮││╭╮╰─╮╰╯╰╮╭─╮╰──╮x╭─╯╰╯╰─╯╰╮.........   113
..............╭╮x╰╯╭╮╰╮│x││x╭╯│││╭─╯│╭╯╰─╯╭╯╰──╮╭╯╰╯x││╰╯x╰╮╭╯╰╮│x╭╯╭╯╭─╯╭─╮╭─╮╭─╯╰─╯│╰╮││╭╯│││││││╰╯│││││╭╮╰─╮╭╯╰╮│╭─╮╰─╯╭──╮╭─╮╭╯.........   114
.............╭╯╰╮╭╮│╰─╯│╭╯│╭╯╭╯│││╭╮││╭╮╭╮│x╭──╯╰─╮╭─╯╰─╮╭╮││╭╮│╰╮╰╮╰╮╰╮╭╯╭╯╰╮│╰╮╭──╮╰╮│││╰╮│││││││╭─╯│╰╯││╰╮╭╯╰╮╭╯╰╯x│╭╮╭╯╭╮│╰╮╰╯..........   115
.............╰─╮╰╯││╭╮╭╯│╭╯│╭╯x╰╯││││││││││╭╯╭╮╭─╮│╰───╮╰╯││╰╯│╰╮╰╮│╭╯╭╯│x╰╮╭╯╰╮╰╯╭─╯x╰╯╰╯╭╯│││││││╰╮╭╯╭╮││x││╭╮│╰─╮╭╮│││╰─╯││╭╯............   116
...............╰─╮╰╯│││╭╯╰╮││╭───╯││││││││││╭╯││╭╯╰──╮╭╯╭─╯│╭─╯╭╯╭╯╰╯╭╯╭╯╭╮││xx│╭─╯x╭╮x╭─╮╰╮│││││││╭╯│x│╰╯╰╮│╰╯│╰╮╭╯││╰╯│╭─╮│╰╯.............   117
...............╭─╯╭╮│╰╯╰╮╭╯╰╯│╭─╮╭╯││╰╯││╰╯│╰╮│││╭╮╭─╯╰╮╰─╮│╰─╮╰╮╰──╮╰╮│╭╯╰╯╰╮╭╯╰──╮│╰─╯╭╯╭╯│╰╯││││╰╮│╭╯╭─╮││╭─╯╭╯╰─╯╰─╮│╰╮││...............   118
...............╰╮╭╯╰╯╭─╮│╰╮x╭╯│╭╯│╭╯│╭─╯╰─╮╰─╯││╰╯│╰╮x╭╯╭─╯│╭─╯╭╯╭╮╭╯x╰╯│╭╮╭─╯╰╮╭╮╭╯╰─╮╭╯x│╭╯╭─╯│╰╯╭╯│╰╮│x╰╯││╭─╯╭╮╭╮╭╮││╭╯╰╯...............   119
................╰╯x╭╮╰╮││╭╯╭╯╭╯╰╮││╭╯│╭╮╭─╯╭──╯╰─╮╰╮╰╮╰╮╰─╮│╰╮╭╯╭╯╰╯╭╮╭╮╰╯╰╯╭──╯│╰╯╭──╯╰─╮╰╯x│╭╮╰╮x│╭╯x││╭──╯│╰╮╭╯││╰╯╰╯│╰─╮................   120
.................╭─╯╰─╯╰╯╰╮╰╮│╭─╯││╰╮│││╰╮x╰╮╭╮╭─╯x╰╮╰╮╰╮╭╯│╭╯│╭╯x╭─╯╰╯╰────╯╭─╮╰──╯╭╮╭─╮╰╮╭╮╰╯╰╮╰╮││╭─╯││╭─╮│╭╯│╭╯╰───╮╰╮╭╯................   121
.................│╭╮╭─╮╭╮╭╯╭╯│╰╮╭╯╰─╯│││╭╯╭╮╰╯│╰─╮╭╮╰╮╰╮│╰╮╰╯╭╯╰╮x╰────────╮╭╯x│╭╮╭╮││╰╮╰╮╰╯╰─╮x│╭╯││╰╮╭╯╰╯╭╯│╰╮│╰╮╭───╯.╰╯.................   122
................╭╯││╰╮│││╰╮╰─╯x│╰───╮╰╯│╰─╯╰╮x│╭─╯││╭╯╭╯╰╮╰─╮╰─╮╰╮╭╮╭──────╯╰─╮╰╯│││││╭╯x╰╮╭─╮│╭╯│x╰╯╭╯╰──╮╰╮╰╮││x│╰─╮......................   123
................╰─╯│╭╯││╰─╯╭╮╭╮│╭╮╭─╯x╭╯╭─╮╭╯╭╯╰──╯│╰╮╰─╮╰╮╭╯╭─╯╭╯│╰╯╭────╮╭─╮╰─╮╰╯│││╰─╮╭╯╰╮╰╯╰╮╰──╮╰╮╭─╮╰╮╰╮│││╭╯╭─╯......................   124
...................╰╯.╰╯..╭╯╰╯╰╯│╰╯x╭─╯╭╯x│╰╮│╭╮╭──╯╭╯╭╮╰╮│╰╮╰╮╭╯x│╭╮│╭───╯│x╰─╮╰╮╭╯││╭╮│╰╮╭╯╭──╯╭╮╭╯x╰╯x╰╮│x╰╯││╰╮╰──╮.....................   125
..........................╰╮╭╮╭╮╰──╮╰─╮│╭─╯╭╯╰╯│╰──╮╰╮││╭╯│╭╯╭╯╰─╮╰╯╰╯╰─╮╭╮╰──╮│╭╯│╭╯╰╯╰╯╭╯╰╮╰─╮╭╯│╰──╮...││x╭─╯╰╮│╭─╮│.....................   126
........................╭──╯│╰╯│╭──╯╭╮││╰╮╭╯x╭─╯╭╮╭╯╭╯││╰╮│╰╮│╭╮╭╯╭─────╯││╭╮╭╯╰╯╭╯│╭────╯╭╮╰─╮╰╯╭╯╭╮╭╯...╰╯x╰╮╭╮│││.╰╯.....................   127
........................│╭──╯╭╮│╰─╮╭╯╰╯│╭╯╰─╮│╭╮│╰╯x╰╮││╭╯╰─╯╰╯││x╰────╮╭╯│││╰──╮╰╮│╰╮╭╮╭╮││╭╮╰╮x│╭╯╰╯........││││││........................   128
........................╰╯.╭─╯╰╯╭╮││╭─╮│╰╮╭─╯│││╰──╮x╰╯│╰╮.....╰╯..╭───╯│╭╯│╰╮╭╮╰╮╰╯x╰╯││││││╰─╯x╰╯...........╰╯╰╯││........................   129
...........................│╭─╮╭╯││││x╰╯╭╯╰─╮││╰╮╭╮╰──╮│╭╯.........╰───╮│╰╮╰╮││╰╮╰────╮││││╰╯.....................╰╯........................   130
...........................╰╯.│╰╮││││╭──╯╭─╮│╰╯╭╯│╰╮╭─╯│╰╮...........╭─╯│╭╯╭╯╰╯x│╭╮╭─╮│╰╯││.................................................   131
..........................╭───╯╭╯╰╯╰╯╰──╮╰╮│╰╮x╰╮│╭╯│xx╰─╯...........│╭╮│╰╮╰──╮╭╯│╰╯x╰╯..╰╯.................................................   132
..........................╰╮╭──╯.....╭──╯╭╯╰─╯x╭╯│╰╮╰╮...............││││╭╯╭─╮││╭╯x╭╮.......................................................   133
...........................╰╯........╰──╮╰─╮...╰╮│╭╯╭╯...............││╰╯│╭╯╭╯│││x╭╯│.......................................................   134
...................................╭────╯╭╮╰───╮││╰╮│................╰╯..╰╯.│╭╯│╰─╯╭╯.......................................................   135
...................................╰─╮╭─╮│╰──╮╭╯╰╯.╰╯.......................╰╯╭╯╭╮╭╯........................................................   136
.....................................╰╯.│╰──╮╰╯...............................╰╮│╰╯.........................................................   137
.....................................╭──╯╭─╮╰──╮...............................╰╯...........................................................   138
.....................................╰───╯.╰───╯............................................................................................   139
";
    let answer = maze.chars().filter(|&ch| ch == 't').count();
    println!("Part 2 answer is {answer}");
}

pub fn run() {
    let input = read_text_from_file("23", "10");
    part_1(&input);
    part_2(&input);
}

#[cfg(test)]
mod test {
    use super::*;

    const INPUT_1: &str = "-L|F7
7S-7|
L|7||
-L-J|
L|-JF";

    const INPUT_2: &str = "7-F7-
.FJ|7
SJLL7
|F--J
LJ.LJ";

    #[test]
    fn test_solution() {
        assert_eq!(calc_steps(INPUT_1), 4);
        assert_eq!(calc_steps(INPUT_2), 8);
    }
}

